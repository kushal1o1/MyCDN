<!DOCTYPE html>
<html>
<head>
    <title>CDN Dashboard</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    {% include 'styles.html' %}
</head>
<body>
    <nav class="navbar">
        <a href="/dashboard" class="navbar-brand">
            <i-lucide data-icon="image"></i-lucide>
            CDN Dashboard
        </a>
        <button class="logout-btn" onclick="logout()">
            <i-lucide data-icon="log-out"></i-lucide>
            Logout
        </button>
    </nav>

    <div class="container">
        <div class="upload-area" onclick="document.getElementById('file-input').click()">
            <input type="file" id="file-input" accept="image/*" multiple onchange="handleFileSelect(event)">
            <i-lucide data-icon="upload-cloud"></i-lucide>
            <h2>Upload Images</h2>
            <p>Click or drag and drop your images here</p>
        </div>

        <div class="image-grid" id="image-grid">
            <!-- Images will be dynamically added here -->
        </div>
    </div>

    <div class="toast" id="toast">
        <i-lucide data-icon="check-circle"></i-lucide>
        <span id="toast-message"></span>
    </div>

    {% include 'scripts.html' %}
    <script>
        // Load images on page load
        loadImages();

        async function loadImages() {
            try {
                const response = await fetch('/api/images');
                if (response.ok) {
                    const images = await response.json();
                    const imageGrid = document.getElementById('image-grid');
                    imageGrid.innerHTML = '';

                    images.forEach(image => {
                        const card = createImageCard(image);
                        imageGrid.appendChild(card);
                    });
                }
            } catch (error) {
                showToast('Failed to load images');
            }
        }

        function createImageCard(image) {
            const card = document.createElement('div');
            card.className = 'image-card';
            card.innerHTML = `
                <img src="/images/${image}" alt="${image}">
                <div class="image-card-footer">
                    <h3>${image}</h3>
                    <div class="image-actions">
                        <button onclick="copyImageUrl('${image}')">
                            <i-lucide data-icon="copy"></i-lucide>
                            Copy URL
                        </button>
                        <button onclick="deleteImage('${image}')">
                            <i-lucide data-icon="trash-2"></i-lucide>
                            Delete
                        </button>
                    </div>
                </div>
            `;
            return card;
        }

        async function handleFileSelect(event) {
            const files = event.target.files;
            for (const file of files) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        showToast(`Uploaded ${file.name}`);
                        loadImages();
                    } else {
                        showToast(`Failed to upload ${file.name}`);
                    }
                } catch (error) {
                    showToast(`Failed to upload ${file.name}`);
                }
            }
            event.target.value = '';
        }

        async function copyImageUrl(filename) {
            const url = `${window.location.origin}/images/${filename}`;
            await navigator.clipboard.writeText(url);
            showToast('Image URL copied to clipboard');
        }

        async function deleteImage(filename) {
            if (confirm('Are you sure you want to delete this image?')) {
                try {
                    const response = await fetch(`/api/images/${filename}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        showToast('Image deleted successfully');
                        loadImages();
                    } else {
                        showToast('Failed to delete image');
                    }
                } catch (error) {
                    showToast('Failed to delete image');
                }
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function logout() {
            window.location.href = '/login';
        }

        // Handle drag and drop
        const uploadArea = document.querySelector('.upload-area');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#3b82f6';
            uploadArea.style.background = '#f0f9ff';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#e4e4e7';
            uploadArea.style.background = 'white';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#e4e4e7';
            uploadArea.style.background = 'white';
            
            const files = e.dataTransfer.files;
            const input = document.getElementById('file-input');
            input.files = files;
            handleFileSelect({ target: input });
        });
    </script>
</body>
</html> 